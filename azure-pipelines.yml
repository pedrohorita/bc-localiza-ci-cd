# ASP.NET Core
# Build and test ASP.NET Core projects targeting .NET Core.
# Add steps that run tests, create a NuGet package, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/dotnet-core

trigger:
- main

pool:
  vmImage: ubuntu-latest

variables:
  buildConfiguration: 'Release'


stages:
  - stage: BuildAndPackage
    displayName: 'Build And Package'
    jobs:
    - job: build
      steps:
        - script: dotnet build --configuration $(buildConfiguration)
          displayName: 'dotnet build $(buildConfiguration)'

        - task: DotNetCoreCLI@2
          inputs:
            command: 'publish'
            publishWebProjects: true
            arguments: '--configuration $(BuildConfiguration) --output $(Build.ArtifactStagingDirectory)'
            zipAfterPublish: true
        - task: PublishBuildArtifacts@1
          inputs:
            pathtoPublish: '$(Build.ArtifactStagingDirectory)' 
            artifactName: 'minhaApi'

  - stage: Release
    displayName: 'Release'
    jobs:
    - job: release
      steps:
      - task: AzureRmWebAppDeployment@4
        inputs:
          ConnectionType: 'AzureRM'
          azureSubscription: 'Assinatura do Azure BÃ¡sico(51322cac-05a1-4b4f-a3e9-dd3172595c84)'
          appType: 'webAppLinux'
          WebAppName: 'api-images'
          packageForLinux: '$(Build.ArtifactStagingDirectory)/*.zip'